"use strict";var vm=new Vue({el:"#app",data:{loginname:"",passwd:"",token:"",progressStatus:"",step:0,progress_value:0,lock:!1,fullscreenLoading:!1,uploadActive:!1,loadingActive:!1,progressActive:!1,tableData:[],total:100,loading:!1,num:5,hostListActive:!1,role:""},created:function(){},methods:{handleSelectionChange:function(t){this.multipleSelection=t},uploadProgress:function(t,o,e){this.progressActive=!0,this.progress_value=parseInt(t.percent)},uploadSuccess:function(t,o,e){var s=this;this.progressStatus="success",this.stopUpload(),swal({type:"success",text:"license文件上传成功，请重新登陆！",background:"#282828",confirmButtonColor:"#666",textColor:"#fff"}).then(function(){s.uploadActive=!1,s.lock=!1})},uploadBefore:function(t){return"license"===t.name?(this.startUpload(),!0):(swal({type:"error",text:"请上传license文件！",background:"#282828",confirmButtonColor:"#666",textColor:"#fff"}),!1)},startUpload:function(){this.loadingActive=!0},stopUpload:function(){this.loadingActive=!1},close:function(){this.lock=!1,this.uploadActive=!1},closeHostList:function(){this.hostListActive=!1},showModal:function(t,o){var e=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};swal({type:s.type||"error",text:t,background:"#282828",confirmButtonColor:"#666",textColor:"#fff",showCancelButton:s.showCancelButton,cancelButtonText:s.cancelButtonText||"取消",confirmButtonText:s.confirmButtonText||"确定"}).then(function(){o&&o(),setTimeout(function(){e.lock=!1},300)})},showUpload:function(){var t=this;setTimeout(function(){t.loadingActive=!1,t.uploadActive=!0,t.progressActive=!1,t.progressStatus="",t.lock=!0},400),this.loadingActive=!0},showHostList:function(){var t=this;this.getData("/login/findAllHost","",function(o,e,s){var n=o.data;n.data.forEach(function(t){t.web_version=t.os_type+"-"+t.os_version+"-"+t.os_arch}),t.tableData=n.data,t.num=n.num,t.loadingActive=!1,t.hostListActive=!0,t.lock=!0}),this.loadingActive=!0},pageChange:function(t){var o=this;setTimeout(function(){o.loadingActive=!1,o.lock=!0},400),this.loadingActive=!0},delById:function(t){var o=this,e={type:"success"};this.showModal("确定要删除该主机吗?",function(){o.loadingActive=!0,o.getData("/login/deleteHost/"+t.host_ids,"",function(s){o.loadingActive=!1,o.showModal("删除"+t.name+"主机成功!",function(){o.showHostList()},e)})},{type:"info",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"})},getData:function(t,o,e,s){var n=this;$.ajax({url:t,type:"post",contentType:"application/json; charset=UTF-8",data:o,success:function(t,o,s){e(t,o,s)},error:function(t,o,e){s&&s(),n.loadingActive=!1,n.showModal("网络错误！")},dataType:"json"})},login:function(){var t=this,o=JSON.stringify({login_name:this.loginname,login_pwd:this.passwd});this.lock||(this.lock=!0,this.getData("/login/dologin",o,function(o,e,s){if(o.status)switch(t.token=s.getResponseHeader("token"),o.status){case 200:localStorage.setItem("token",s.getResponseHeader("token"));var n=JSON.stringify({token:s.getResponseHeader("token")});t.getData("/login/loged/",n,function(o){t.role=o.data.role,t.token=s.getResponseHeader("token"),t.$refs.loged.submit()});break;case 400:t.showModal(o.msg,t.showUpload);break;case 630:t.showModal("license文件过期或点数已超，请联系系统管理员处理！");break;case 700:t.showModal("license文件过期，请重新上传license文件。",t.showUpload);break;case 701:t.showModal("检测到主机点数不符合要求，请先删除主机。",t.showHostList);break;case 702:t.showModal("主机校验不符，请重新上传license文件。",t.showUpload);break;default:t.showModal(o.msg)}}))}}});